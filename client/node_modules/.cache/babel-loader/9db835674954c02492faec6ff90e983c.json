{"ast":null,"code":"var _jsxFileName = \"/Users/carloscarrasquillo/Documents/Documents/code/hackathon/swamphacks_2020/website/client/src/components/Render/Render.js\";\nimport React, { Component } from 'react';\nimport * as THREE from 'three';\nimport Dropzone from 'react-dropzone';\nimport Button from 'react-bootstrap/Button';\nimport DropdownButton from 'react-bootstrap/DropdownButton';\nimport Dropdown from 'react-bootstrap/Dropdown';\nimport ButtonGroup from 'react-bootstrap/ButtonGroup';\nimport ReactTooltip from 'react-tooltip';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\nimport { STLLoader } from 'three/examples/jsm/loaders/STLLoader';\nimport { OBJLoader } from 'three/examples/jsm/loaders/OBJLoader';\nimport { FBXLoader } from 'three/examples/jsm/loaders/FBXLoader';\nimport { TDSLoader } from 'three/examples/jsm/loaders/TDSLoader';\nimport { Redirect } from 'react-router-dom';\n\nvar axios = require('axios');\n\nclass Render extends Component {\n  constructor(props) {\n    super(props);\n\n    this.onDrop = files => {\n      var file = files[0];\n      this.renderFile(file);\n    };\n\n    this.getMats = () => {\n      axios.get(\"/api/mat\").then(mat => {\n        var matNames = [];\n        mat.data.forEach(function (element) {\n          materialObjects.push(element);\n          matNames.push(element.name);\n        });\n        this.setState({\n          materialsList: matNames\n        });\n        this.setState({\n          mats: mat.data\n        });\n      });\n    };\n\n    this.onChangeFileUpload = event => {\n      uploadedFile = event.target.files[0];\n    };\n\n    this.state = {\n      currentFile: null,\n      link: null,\n      fileRendered: false\n    };\n    this.onChangeFileUpload = this.onChangeFileUpload.bind(this);\n  }\n\n  handleClick() {\n    this.refs.fileUploader.click();\n  }\n\n  checkExtensionValidity(file) {\n    var fileExtension = file.name.substring(file.name.lastIndexOf('.') + 1, file.name.length) || file.name;\n    if (supportedFileExtensions.includes(fileExtension.toLowerCase())) return true;else return false;\n  }\n\n  renderFile(file) {\n    if (file) {\n      if (this.checkExtensionValidity(file)) {\n        document.getElementById('infoAndInstruc').style.visibility = 'hidden';\n        this.setState({\n          fileRendered: true\n        });\n        this.openFile(file);\n        var text = document.getElementById('but-upload');\n        this.setState({\n          currentFile: file\n        });\n      } else {\n        this.setState({\n          fileRendered: false\n        });\n        document.getElementById('infoAndInstruc').style.visibility = 'visible';\n        document.getElementById(\"renderInstruc\").textContent = \"File not accepted. Try again.\";\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    this.mesh = null;\n    this.renderer = null;\n    this.scene = null;\n    this.camera = null;\n    this.controls = null;\n  }\n\n  componentDidMount() {\n    var mesh, renderer, scene, camera, controls, bb, rect, uploadedFile, selectedMaterial;\n    var rotate = 'Z';\n    var vector = new THREE.Vector3(-1, 0, 0);\n    var pause = false;\n\n    this.openFile = file => {\n      uploadedFile = file;\n\n      if (!mesh) {\n        init();\n        load(file, true);\n      } else {\n        update();\n        load(file, false);\n      }\n    };\n\n    function update() {\n      scene.remove(mesh);\n      mesh.geometry.dispose();\n      mesh.material.dispose();\n    }\n\n    function load(file, doAnimate) {\n      const tempURL = URL.createObjectURL(file);\n      var str = file.name.split('.').pop();\n      var ext = str.toLowerCase();\n      var loader;\n\n      if (ext === 'stl') {\n        loader = new STLLoader();\n        loader.load(tempURL, function (geometry) {\n          geometry.center();\n          make(geometry, doAnimate);\n        });\n      } else if (ext === 'obj') {\n        loader = new OBJLoader();\n        loader.load(tempURL, function (object) {\n          var g = new THREE.Geometry().fromBufferGeometry(object.children[\"0\"].geometry);\n          g.center();\n          make(g, doAnimate);\n        });\n      } else if (ext === 'fbx') {\n        loader = new FBXLoader();\n        loader.load(tempURL, function (object) {\n          var g = new THREE.Geometry().fromBufferGeometry(object.children[\"0\"].geometry);\n          g.center();\n          make(g, doAnimate);\n        });\n      } else if (ext === '3ds') {\n        loader = new TDSLoader();\n        loader.load(tempURL, function (object) {\n          var g = new THREE.Geometry().fromBufferGeometry(object.children[\"0\"].geometry);\n          g.center();\n          make(g, doAnimate);\n        });\n      }\n\n      URL.revokeObjectURL(tempURL);\n    }\n\n    function make(geometry, doAnimate) {\n      var material;\n\n      if (selectedMaterial) {\n        material = selectedMaterial;\n      } else {\n        material = new THREE.MeshNormalMaterial();\n      }\n\n      mesh = new THREE.Mesh(geometry, material);\n      var boundingBox = new THREE.Box3().setFromObject(mesh);\n      var sizeHouse = bb.getSize();\n      var sizeObject = boundingBox.getSize();\n      var ratio = sizeObject.divide(sizeHouse);\n      var maxRatio = Math.max(ratio.x, ratio.y, ratio.z);\n      var invertRatio = 1 / maxRatio;\n      mesh.scale.set(invertRatio, invertRatio, invertRatio);\n      mesh.position.set(0, 0.25, 0);\n      mesh.setRotationFromAxisAngle(vector, Math.PI / 2);\n      scene.add(mesh);\n\n      if (doAnimate) {\n        animate();\n      }\n    }\n\n    function init() {\n      var container = document.getElementById(\"container\");\n      rect = container.getBoundingClientRect();\n      renderer = new THREE.WebGLRenderer({\n        antialias: true\n      });\n      renderer.setSize(rect.width - 2, rect.height - 2);\n      container.appendChild(renderer.domElement);\n      scene = new THREE.Scene();\n      scene.background = new THREE.Color(0xF8F9FA);\n      camera = new THREE.PerspectiveCamera(1, rect.width / rect.height, 1, 1000);\n      controls = new OrbitControls(camera, container);\n      var axes = new THREE.AxesHelper(1);\n      axes.position.set(0, -0.25, 0);\n      scene.add(axes);\n      var gridHelper = new THREE.GridHelper(1, 5);\n      gridHelper.position.set(0, -0.25, 0);\n      scene.add(gridHelper);\n      var boxGeometry = new THREE.BoxGeometry(1, 1, 1);\n      var boxMaterial = new THREE.MeshNormalMaterial();\n      var boxMesh = new THREE.Mesh(boxGeometry, boxMaterial);\n      bb = new THREE.Box3().setFromObject(boxMesh);\n      var height = bb.getSize().y;\n      var dist = height / 2 / Math.tan(Math.PI * 1 / 360);\n      camera.position.set(dist + 25, dist + 25, dist + 25);\n      camera.lookAt(boxMesh.position);\n      camera.updateProjectionMatrix();\n      window.addEventListener('resize', onWindowResize, false);\n      document.getElementById(\"container\").addEventListener('mousedown', mousedownfunc, false);\n      document.getElementById(\"container\").addEventListener('mouseup', mouseupfunc, false);\n    }\n\n    function mousedownfunc() {\n      pause = true;\n    }\n\n    function mouseupfunc() {\n      pause = false;\n    }\n\n    function onWindowResize() {\n      camera.aspect = rect.width / rect.height;\n      camera.updateProjectionMatrix();\n      renderer.setSize(rect.width - 2, rect.height - 2);\n    }\n\n    function animate() {\n      if (!pause) {\n        if (rotate === 'X') {\n          mesh.rotation.x += 0.01;\n        } else if (rotate === 'Y') {\n          mesh.rotation.y += 0.01;\n        } else if (rotate === 'Z') {\n          mesh.rotation.z += 0.01;\n        }\n      }\n\n      requestAnimationFrame(animate);\n      renderer.render(scene, camera);\n    }\n  }\n\n  getSupportedFileString() {\n    return supportedFileExtensions.join(\", \");\n  } //<-------------------------------------------------------------------------Copied from Material.js Component------------------------------------------------------------------------->\n  //Gets the materials and finishes from the API\n\n\n  handleChangeNext(value) {\n    console.log('Sending'); //Maybe need to send?\n    //countryCode: this.state.countryCode, stateCode: this.state.stateCode, city: city, zipcode: zipcode, currency: currency\n  } //Changes the finishes based on the material chosen\n\n\n  handleChangeMaterial(eventKey) {\n    var string = eventKey.toString();\n    var array = string.split(',');\n    var index = array[0];\n    var name = array[1];\n    var text = document.getElementById('but-material');\n    text.textContent = name;\n    this.setState({\n      finishState: false\n    });\n    materialzID = materialObjects[index].materialID;\n    finishesObjects = materialObjects[index].finishes;\n    finishNames = [];\n    materialz = name;\n    var materialChosen = this.state.mats.find(isMaterial);\n    console.log(materialChosen);\n    materialChosen.finishes.forEach(function (element) {\n      finishes.push(element);\n      finishNames.push(element.name);\n    });\n    this.setState({\n      finishList: finishNames,\n      finish: this.state.finishList[0]\n    });\n    finishID = finishes[0].finishID;\n    this.updateMaterial(name, finishNames[0]);\n    document.getElementById('but-material').style.borderColor = \"#949494\";\n    document.getElementById('but-finish').style.borderColor = \"#949494\";\n  }\n\n  checkFinish() {\n    if (this.state.finishState) {\n      return \"Select\";\n    } else {\n      return this.state.finishList[0];\n    }\n  }\n\n  handleChangeFinish(eventKey) {\n    var string = eventKey.toString();\n    var array = string.split(',');\n    var index = array[0];\n    var name = array[1];\n    var text = document.getElementById('but-finish');\n    text.textContent = name;\n    finishID = finishes[index].finishID;\n    this.setState({\n      finish: name\n    });\n    this.updateMaterial(materialz, name);\n    document.getElementById('but-finish').style.borderColor = \"#949494\";\n  }\n\n  handleSubmit(event) {\n    if (materialzID && finishID && this.state.scale) {\n      var text = document.getElementById('priceText');\n      text.textContent = \"Calculating\";\n      document.getElementById('wave').style.display = '';\n      this.setState({\n        cartState: false\n      });\n      this.setState({\n        error: ' '\n      });\n      event.preventDefault();\n      const reactData = {\n        material: materialzID,\n        finish: finishID,\n        countryCode: this.state.countryCode,\n        stateCode: this.state.stateCode,\n        city: city,\n        zipcode: zipcode,\n        currency: currency,\n        scale: this.state.scale,\n        url: url\n      }; //Send the information to Price.server.controller\n\n      axios.post(\"/api/sendMat\", reactData).then(price => //Get the price back from Price.server.controller\n      {\n        console.log(price);\n        this.setState({\n          price: price.data.modelPrice\n        });\n        this.setState({\n          token: price.data.token\n        });\n\n        if (this.state.price == '0') {\n          this.setState({\n            error: \"The dimensions of the model are too large or too small.\"\n          });\n          text.textContent = \"Error\";\n          document.getElementById('wave').style.display = 'none';\n        } else {\n          this.setState({\n            buttonDisabledState: false\n          });\n          text.textContent = \"Add to Cart for: $\" + price.data.modelPrice;\n          document.getElementById('wave').style.display = 'none';\n        }\n      }).catch(err => {\n        text.textContent = \"Error: Please Refresh the Page!\";\n        document.getElementById('wave').style.display = 'none';\n        console.log('error', err);\n      });\n    } else {\n      if (!materialzID) {\n        document.getElementById('but-material').style.borderColor = \"#e32c2b\";\n      }\n\n      if (!finishID) {\n        document.getElementById('but-finish').style.borderColor = \"#e32c2b\";\n      }\n\n      if (!this.state.scale) {\n        document.getElementById('but-scale').style.borderColor = \"#e32c2b\";\n      }\n    }\n  }\n\n  handleChangeScale(eventKey) {\n    this.state.scale = eventKey / 100;\n    var text = document.getElementById('but-scale');\n    text.textContent = eventKey + '%';\n    document.getElementById('but-scale').style.borderColor = \"#949494\";\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 382\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 383\n      },\n      __self: this\n    }, React.createElement(Dropzone, {\n      onDrop: this.onDrop,\n      noClick: this.state.fileRendered,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 384\n      },\n      __self: this\n    }, ({\n      getRootProps,\n      getInputProps,\n      isDragActive\n    }) => React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 385\n      },\n      __self: this\n    }, React.createElement(\"div\", Object.assign({\n      id: \"infoAndInstruc\",\n      style: {\n        position: \"absolute\",\n        marginRight: \"70px\",\n        borderStyle: \"solid\",\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        height: \"700px\",\n        width: \"700px\",\n        backgroundColor: \"#F8F9FA\"\n      }\n    }, getRootProps(), {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 386\n      },\n      __self: this\n    }), React.createElement(\"input\", Object.assign({}, getInputProps(), {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 387\n      },\n      __self: this\n    }))), React.createElement(\"div\", Object.assign({\n      id: \"container\",\n      style: {\n        postion: \"absolute\",\n        marginRight: \"70px\",\n        borderStyle: \"solid\",\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        height: \"700px\",\n        width: \"700px\",\n        backgroundColor: \"#F8F9FA\"\n      }\n    }, getRootProps(), {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 390\n      },\n      __self: this\n    }), React.createElement(\"input\", Object.assign({}, getInputProps(), {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 391\n      },\n      __self: this\n    })))))));\n  }\n\n}\n\nexport default Render;","map":{"version":3,"sources":["/Users/carloscarrasquillo/Documents/Documents/code/hackathon/swamphacks_2020/website/client/src/components/Render/Render.js"],"names":["React","Component","THREE","Dropzone","Button","DropdownButton","Dropdown","ButtonGroup","ReactTooltip","OrbitControls","STLLoader","OBJLoader","FBXLoader","TDSLoader","Redirect","axios","require","Render","constructor","props","onDrop","files","file","renderFile","getMats","get","then","mat","matNames","data","forEach","element","materialObjects","push","name","setState","materialsList","mats","onChangeFileUpload","event","uploadedFile","target","state","currentFile","link","fileRendered","bind","handleClick","refs","fileUploader","click","checkExtensionValidity","fileExtension","substring","lastIndexOf","length","supportedFileExtensions","includes","toLowerCase","document","getElementById","style","visibility","openFile","text","textContent","componentWillUnmount","mesh","renderer","scene","camera","controls","componentDidMount","bb","rect","selectedMaterial","rotate","vector","Vector3","pause","init","load","update","remove","geometry","dispose","material","doAnimate","tempURL","URL","createObjectURL","str","split","pop","ext","loader","center","make","object","g","Geometry","fromBufferGeometry","children","revokeObjectURL","MeshNormalMaterial","Mesh","boundingBox","Box3","setFromObject","sizeHouse","getSize","sizeObject","ratio","divide","maxRatio","Math","max","x","y","z","invertRatio","scale","set","position","setRotationFromAxisAngle","PI","add","animate","container","getBoundingClientRect","WebGLRenderer","antialias","setSize","width","height","appendChild","domElement","Scene","background","Color","PerspectiveCamera","axes","AxesHelper","gridHelper","GridHelper","boxGeometry","BoxGeometry","boxMaterial","boxMesh","dist","tan","lookAt","updateProjectionMatrix","window","addEventListener","onWindowResize","mousedownfunc","mouseupfunc","aspect","rotation","requestAnimationFrame","render","getSupportedFileString","join","handleChangeNext","value","console","log","handleChangeMaterial","eventKey","string","toString","array","index","finishState","materialzID","materialID","finishesObjects","finishes","finishNames","materialz","materialChosen","find","isMaterial","finishList","finish","finishID","updateMaterial","borderColor","checkFinish","handleChangeFinish","handleSubmit","display","cartState","error","preventDefault","reactData","countryCode","stateCode","city","zipcode","currency","url","post","price","modelPrice","token","buttonDisabledState","catch","err","handleChangeScale","getRootProps","getInputProps","isDragActive","marginRight","borderStyle","justifyContent","alignItems","backgroundColor","postion"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport * as THREE from 'three';\nimport Dropzone from 'react-dropzone'\nimport Button from 'react-bootstrap/Button';\nimport DropdownButton from 'react-bootstrap/DropdownButton';\nimport Dropdown from 'react-bootstrap/Dropdown';\nimport ButtonGroup from 'react-bootstrap/ButtonGroup';\nimport ReactTooltip from 'react-tooltip';\nimport {OrbitControls} from 'three/examples/jsm/controls/OrbitControls';\nimport {STLLoader} from 'three/examples/jsm/loaders/STLLoader';\nimport {OBJLoader} from 'three/examples/jsm/loaders/OBJLoader';\nimport {FBXLoader} from 'three/examples/jsm/loaders/FBXLoader';\nimport {TDSLoader} from 'three/examples/jsm/loaders/TDSLoader';\nimport {Redirect} from 'react-router-dom';\nvar axios = require('axios');\n\nclass Render extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            currentFile: null,\n            link: null,\n            fileRendered: false\n        };\n\n        this.onChangeFileUpload = this.onChangeFileUpload.bind(this)\n    }\n\n    handleClick() {\n        this.refs.fileUploader.click();\n    }\n\n    checkExtensionValidity(file) {\n      var fileExtension = file.name.substring(file.name.lastIndexOf('.')+1, file.name.length) || file.name;\n\n      if (supportedFileExtensions.includes(fileExtension.toLowerCase())) return true;\n      else return false;\n    }\n\n    renderFile(file) {\n        if (file) {\n            if (this.checkExtensionValidity(file)) {\n                document.getElementById('infoAndInstruc').style.visibility = 'hidden';\n                this.setState({ fileRendered: true });\n                this.openFile(file);\n                var text = document.getElementById('but-upload');\n                this.setState({ currentFile: file });\n            }\n            else {\n                this.setState({ fileRendered: false });\n                document.getElementById('infoAndInstruc').style.visibility = 'visible';\n                document.getElementById(\"renderInstruc\").textContent = \"File not accepted. Try again.\";\n            }\n        }\n    }\n\n    onDrop = (files) => {\n        var file = files[0];\n        this.renderFile(file);\n    }\n\n    componentWillUnmount() {\n        this.mesh = null;\n        this.renderer = null;\n        this.scene = null;\n        this.camera = null;\n        this.controls = null;\n    }\n\n    componentDidMount() {\n        var mesh, renderer, scene, camera, controls, bb, rect, uploadedFile, selectedMaterial;\n        var rotate = 'Z';\n        var vector = new THREE.Vector3(-1, 0, 0);\n        var pause = false;\n\n        this.openFile = (file) => {\n            uploadedFile = file;\n            if (!mesh) {\n                init();\n                load(file, true);\n            }\n            else {\n                update();\n                load(file, false);\n            }\n        }\n\n\n        function update() {\n            scene.remove(mesh);\n            mesh.geometry.dispose();\n            mesh.material.dispose();\n        }\n\n        function load(file, doAnimate) {\n            const tempURL = URL.createObjectURL(file);\n\n            var str = file.name.split('.').pop();\n            var ext = str.toLowerCase();\n            var loader;\n\n            if (ext === 'stl') {\n                loader = new STLLoader();\n                loader.load(tempURL, function (geometry) {\n                    geometry.center();\n                    make(geometry, doAnimate);\n                });\n            }\n            else if (ext === 'obj') {\n                loader = new OBJLoader();\n                loader.load(tempURL, function (object) {\n                    var g = new THREE.Geometry().fromBufferGeometry(object.children[\"0\"].geometry);\n                    g.center();\n                    make(g, doAnimate);\n                });\n            }\n            else if (ext === 'fbx') {\n                loader = new FBXLoader();\n                loader.load(tempURL, function(object) {\n                    var g = new THREE.Geometry().fromBufferGeometry(object.children[\"0\"].geometry);\n                    g.center();\n                    make(g, doAnimate);\n                });\n            }\n            else if (ext === '3ds') {\n                loader = new TDSLoader();\n                loader.load(tempURL, function(object) {\n                    var g = new THREE.Geometry().fromBufferGeometry(object.children[\"0\"].geometry);\n                    g.center();\n                    make(g, doAnimate);\n                });\n            }\n\n            URL.revokeObjectURL(tempURL);\n        }\n\n        function make(geometry, doAnimate) {\n            var material;\n            if (selectedMaterial) {\n                material = selectedMaterial;\n            }\n            else {\n                material = new THREE.MeshNormalMaterial();\n            }\n            mesh = new THREE.Mesh(geometry, material);\n            var boundingBox = new THREE.Box3().setFromObject(mesh);\n            var sizeHouse = bb.getSize();\n            var sizeObject = boundingBox.getSize();\n            var ratio = sizeObject.divide(sizeHouse);\n            var maxRatio = Math.max(ratio.x, ratio.y, ratio.z);\n            var invertRatio = 1 / maxRatio;\n            mesh.scale.set(invertRatio, invertRatio, invertRatio);\n            mesh.position.set(0, 0.25, 0);\n            mesh.setRotationFromAxisAngle(vector, Math.PI/2);\n            scene.add(mesh);\n            if (doAnimate) {\n                animate();\n            }\n        }\n\n        function init() {\n            var container = document.getElementById(\"container\");\n            rect = container.getBoundingClientRect();\n\n            renderer = new THREE.WebGLRenderer({ antialias: true });\n            renderer.setSize(rect.width - 2, rect.height - 2);\n\n            container.appendChild(renderer.domElement);\n\n            scene = new THREE.Scene();\n            scene.background = new THREE.Color(0xF8F9FA);\n            camera = new THREE.PerspectiveCamera(1, rect.width / rect.height, 1, 1000);\n            controls = new OrbitControls(camera, container);\n\n            var axes = new THREE.AxesHelper(1);\n            axes.position.set(0, -0.25, 0);\n            scene.add(axes);\n\n            var gridHelper = new THREE.GridHelper(1, 5);\n            gridHelper.position.set(0, -0.25, 0);\n            scene.add(gridHelper);\n\n            var boxGeometry = new THREE.BoxGeometry(1, 1, 1);\n            var boxMaterial = new THREE.MeshNormalMaterial();\n            var boxMesh = new THREE.Mesh(boxGeometry, boxMaterial);\n            bb = new THREE.Box3().setFromObject(boxMesh);\n            var height = bb.getSize().y;\n            var dist = height / 2 / Math.tan(Math.PI * 1 / 360);\n            camera.position.set(dist + 25, dist + 25, dist + 25);\n            camera.lookAt(boxMesh.position);\n            camera.updateProjectionMatrix();\n\n            window.addEventListener('resize', onWindowResize, false);\n            document.getElementById(\"container\").addEventListener('mousedown', mousedownfunc, false);\n            document.getElementById(\"container\").addEventListener('mouseup', mouseupfunc, false);\n        }\n\n        function mousedownfunc() {\n            pause = true;\n        }\n\n        function mouseupfunc() {\n            pause = false;\n        }\n\n        function onWindowResize() {\n            camera.aspect = (rect.width) / (rect.height);\n            camera.updateProjectionMatrix();\n            renderer.setSize(rect.width - 2, rect.height - 2);\n        }\n\n        function animate() {\n            if (!pause) {\n                if (rotate === 'X') {\n                    mesh.rotation.x += 0.01;\n                }\n                else if (rotate === 'Y') {\n                    mesh.rotation.y += 0.01;\n                }\n                else if (rotate === 'Z') {\n                    mesh.rotation.z += 0.01;\n                }\n            }\n            requestAnimationFrame(animate);\n            renderer.render(scene, camera);\n        }\n    }\n\n    getSupportedFileString() {\n      return supportedFileExtensions.join(\", \")\n    }\n\n    //<-------------------------------------------------------------------------Copied from Material.js Component------------------------------------------------------------------------->\n    //Gets the materials and finishes from the API\n    getMats = () =>\n    {\n        axios.get(\"/api/mat\")\n        .then((mat) =>\n        {\n            var matNames = [];\n            mat.data.forEach(function(element){\n                materialObjects.push(element)\n                matNames.push(element.name)\n            });\n            this.setState({ materialsList: matNames })\n            this.setState({mats: mat.data})\n        })\n    }\n\n    handleChangeNext(value){\n        console.log('Sending')\n        //Maybe need to send?\n        //countryCode: this.state.countryCode, stateCode: this.state.stateCode, city: city, zipcode: zipcode, currency: currency\n    }\n\n    //Changes the finishes based on the material chosen\n    handleChangeMaterial(eventKey) {\n        var string = eventKey.toString();\n        var array = string.split(',');\n        var index = array[0];\n        var name = array[1];\n        var text = document.getElementById('but-material');\n        text.textContent = name;\n        this.setState({finishState: false});\n\n        materialzID = materialObjects[index].materialID;\n        finishesObjects = materialObjects[index].finishes\n\n        finishNames = [];\n        materialz = name;\n        var materialChosen = this.state.mats.find(isMaterial);\n        console.log(materialChosen)\n\n        materialChosen.finishes.forEach(function(element){\n            finishes.push(element)\n            finishNames.push(element.name);\n        });\n\n        this.setState({finishList: finishNames, finish: this.state.finishList[0]})\n        finishID = finishes[0].finishID;\n\n        this.updateMaterial(name, finishNames[0]);\n        document.getElementById('but-material').style.borderColor = \"#949494\";\n        document.getElementById('but-finish').style.borderColor = \"#949494\";\n    }\n\n    checkFinish() {\n        if (this.state.finishState) {\n            return \"Select\";\n        }\n        else {\n            return this.state.finishList[0];\n        }\n    }\n\n    handleChangeFinish(eventKey) {\n        var string = eventKey.toString();\n        var array = string.split(',');\n        var index = array[0];\n        var name = array[1];\n        var text = document.getElementById('but-finish');\n        text.textContent = name;\n\n        finishID = finishes[index].finishID;\n        this.setState({finish: name})\n        this.updateMaterial(materialz, name);\n        document.getElementById('but-finish').style.borderColor = \"#949494\";\n    }\n\n    onChangeFileUpload=event=>{\n        uploadedFile = event.target.files[0];\n    }\n\n    handleSubmit(event) {\n        if (materialzID && finishID && this.state.scale) {\n            var text = document.getElementById('priceText');\n            text.textContent = \"Calculating\";\n            document.getElementById('wave').style.display = '';\n            this.setState({cartState: false});\n            this.setState({error: ' '});\n            event.preventDefault();\n\n            const reactData = {\n                material: materialzID,\n                finish: finishID,\n                countryCode: this.state.countryCode,\n                stateCode: this.state.stateCode,\n                city: city,\n                zipcode: zipcode,\n                currency: currency,\n                scale: this.state.scale,\n                url: url\n            }\n\n            //Send the information to Price.server.controller\n            axios.post(\"/api/sendMat\", reactData)\n                .then((price) => //Get the price back from Price.server.controller\n                {\n                    console.log(price)\n                    this.setState({price: price.data.modelPrice})\n                    this.setState({token: price.data.token})\n                    if (this.state.price == '0') {\n                        this.setState({error: \"The dimensions of the model are too large or too small.\"})\n                        text.textContent = \"Error\";\n                        document.getElementById('wave').style.display = 'none';\n                    } else {\n                        this.setState({buttonDisabledState: false});\n                      text.textContent = \"Add to Cart for: $\" + price.data.modelPrice;\n                      document.getElementById('wave').style.display = 'none';\n                    }\n                })\n                .catch((err) => {\n                    text.textContent = \"Error: Please Refresh the Page!\";\n                    document.getElementById('wave').style.display = 'none';\n                    console.log('error', err)\n                })\n        }\n        else {\n            if (!materialzID) {\n                document.getElementById('but-material').style.borderColor = \"#e32c2b\";\n            }\n            if (!finishID) {\n                document.getElementById('but-finish').style.borderColor = \"#e32c2b\";\n            }\n            if (!this.state.scale) {\n                document.getElementById('but-scale').style.borderColor = \"#e32c2b\";\n            }\n        }\n    }\n\n    handleChangeScale(eventKey){\n        this.state.scale = eventKey/100;\n        var text = document.getElementById('but-scale');\n        text.textContent = eventKey + '%';\n\n        document.getElementById('but-scale').style.borderColor = \"#949494\";\n    }\n\n    render() {\n        return (\n            <div>\n                    <div>\n                        <Dropzone onDrop={this.onDrop} noClick={this.state.fileRendered}>{({ getRootProps, getInputProps, isDragActive }) => (\n                            <div>\n                                <div id=\"infoAndInstruc\" style={{ position: \"absolute\", marginRight: \"70px\", borderStyle: \"solid\", display: 'flex', justifyContent: 'center', alignItems: 'center', height: \"700px\", width: \"700px\", backgroundColor: \"#F8F9FA\" }} {...getRootProps()}>\n                                    <input {...getInputProps()} />\n                                </div>\n\n                                <div id=\"container\" style={{ postion: \"absolute\", marginRight: \"70px\", borderStyle: \"solid\", display: 'flex', justifyContent: 'center', alignItems: 'center', height: \"700px\", width: \"700px\", backgroundColor: \"#F8F9FA\" }} {...getRootProps()}>\n                                    <input {...getInputProps()} />\n                                </div>\n                            </div>\n                        )}\n                        </Dropzone>\n                    </div>\n            </div>\n        );\n    }\n}\n\nexport default Render;\n"]},"metadata":{},"sourceType":"module"}